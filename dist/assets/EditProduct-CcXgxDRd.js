import{u as L,x as O,d as y,a as T,r as c,e as V,j as s,m as $,I as n,aB as B,W as X,V as d,aC as G,h as J}from"./index-BJZVsLRM.js";import{S as I}from"./SelectField-D2mdJDlv.js";import{u as K}from"./uploadMedia-BSrAngoH.js";import{p as Q}from"./product.api-BG8uAXJK.js";const ae=()=>{const j=L(),{id:v}=O(),m=y(e=>e.fabrics),{products:g}=y(e=>e.product),P=y(e=>e.category.categories||[]),a=g==null?void 0:g.find(e=>e._id===v),{register:l,handleSubmit:F,formState:{errors:o},reset:w,watch:k}=T(),[u,q]=c.useState([]),[p,N]=c.useState([]),[S,h]=c.useState([]),[x,A]=c.useState(null),[b,C]=c.useState(!1),_=k(),D=V();c.useEffect(()=>{if(a){const e={name:a.name,description:a.description,price:a.price,stock:a.stock,category:a.category._id||a.category,fabric:a.fabric._id,technique:a.technique,color:a.color,weight:a.weight,assurance:a.assurance,hsnCode:a.hsnCode};w(e),A(e);const r=Array.isArray(a.images)?a.images:[];q(r),h(r)}},[a,w]);const E=e=>{const r=Array.from(e.target.files);N(i=>[...i,...r]);const t=r.map(i=>URL.createObjectURL(i));h(i=>[...i,...t])},U=e=>{if(h(r=>r.filter((t,i)=>i!==e)),e<u.length)q(r=>r.filter((t,i)=>i!==e));else{const r=e-u.length;N(t=>t.filter((i,f)=>f!==r))}},R=()=>{var e;if(!x)return!1;for(let r in x)if(String(_[r])!==String(x[r]))return!0;return p.length>0||u.length!==(((e=a.images)==null?void 0:e.length)||0)},H=async e=>{if(!R()){d.error("No changes detected.");return}C(!0);const r=d.loading("Please wait...");try{let t=[];p.length>0&&(t=await K(p));const i=Array.isArray(t)?t:[t],f=[...u,...i],W={...e,images:f},z=await Q.updateProduct(W,v);D(G(z)),d.success("Product updated successfully"),j(-1)}catch(t){J(t)}finally{d.dismiss(r),C(!1)}},M=()=>j(-1);return a?s.jsxs($.div,{initial:{opacity:0,x:20},animate:{opacity:1,x:0},transition:{duration:.3},className:"space-y-6 p-4 sm:p-6 max-w-2xl mx-auto",children:[s.jsx("h3",{className:"text-lg font-semibold uppercase text-gray-800 mb-4 tracking-wide",children:"Edit Product"}),s.jsxs("form",{onSubmit:F(H),className:"space-y-4",children:[s.jsx(n,{label:"Name",name:"name",register:l,errors:o,rules:{required:"Product name is required"}}),s.jsx(n,{label:"Description",name:"description",register:l,errors:o,rules:{required:"Description is required"}}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(n,{label:"Price",name:"price",type:"number",register:l,errors:o,rules:{required:"Price is required",min:{value:0,message:"Must be positive"}}}),s.jsx(n,{label:"Stock",name:"stock",type:"number",register:l,errors:o,rules:{required:"Stock is required",min:{value:0,message:"Must be positive"}}})]}),s.jsx(I,{label:"Category",name:"category",register:l,errors:o,value:a.category,rules:{required:"Category is required"},options:P.map(e=>({value:e._id||e.value,label:e.name||e.label}))}),s.jsxs("div",{children:[s.jsxs("label",{className:"block text-sm text-gray-600 mb-1 flex items-center gap-2",children:[s.jsx(B,{size:16})," Images"]}),s.jsx("input",{type:"file",accept:"image/*",multiple:!0,onChange:E,className:"w-full p-2 border border-gray-300 rounded-md text-sm text-gray-800"}),S.length>0&&s.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:S.map((e,r)=>s.jsxs("div",{className:"relative w-16 h-16",children:[s.jsx("img",{src:e,alt:`Preview ${r}`,className:"w-full h-full object-cover rounded-md"}),s.jsx("button",{type:"button",onClick:()=>U(r),className:"absolute top-0 right-0 bg-white rounded-full p-0.5 shadow-md",children:s.jsx(X,{size:12})})]},r))})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(I,{label:"Fabric",name:"fabric",register:l,errors:o,rules:{required:"Fabric is required"},options:m==null?void 0:m.map(e=>({value:e._id||e.value,label:e.title||e.label})),value:a.fabric._id}),s.jsx(n,{label:"Technique",name:"technique",register:l,errors:o,rules:{required:"Technique is required"}})]}),s.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4",children:[s.jsx(n,{label:"Color",name:"color",register:l,errors:o,rules:{required:"Color is required"}}),s.jsx(n,{label:"Weight",name:"weight",register:l,errors:o,rules:{required:"Weight is required"}})]}),s.jsx(n,{label:"Assurance",name:"assurance",register:l,errors:o,rules:{required:"Assurance is required"}}),s.jsx(n,{label:"HSN Code",name:"hsnCode",register:l,errors:o,rules:{required:"HSN Code is required",pattern:{value:/^[0-9]+$/,message:"HSN Code must contain only numbers"}}}),s.jsxs("div",{className:"flex flex-col sm:flex-row gap-3",children:[s.jsx("button",{type:"submit",disabled:b,style:{cursor:b?"not-allowed":"pointer"},className:"bg-neutral-950 text-white px-4 py-2 h-12 text-sm uppercase hover:bg-gray-700 transition-colors duration-200 shadow-md w-full",children:b?"Saving...":"Save"}),s.jsx("button",{type:"button",onClick:M,className:"bg-gray-200 text-gray-800 px-4 py-2 text-sm uppercase hover:bg-gray-300 transition-colors duration-200 shadow-md w-full",children:"Cancel"})]})]})]}):s.jsx("div",{className:"text-center py-8",children:s.jsx("p",{className:"text-gray-600 text-sm",children:"Product not found."})})};export{ae as default};
